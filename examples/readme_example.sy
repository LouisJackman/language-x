#!/usr/bin/env sylan

fun fizzBuzz
    /** The (In)famous FizzBuzz. */
(n Int) Int {
    1.up(to: n).each -> {
        switch {
            0 == (it % 15) { "FizzBuzz" }
            0 == (it % 5) { "Fizz" }
            0 == (it % 3) { "Buzz" }
            _ { it }
        } |> println
    }
}

enum List
    /** Data Structures & Pattern Matching */
[Element](
    Node(element Element, next This),
    Nil,
) {
    fun each(do (element Element)) {
        if var Node(element, next) = this {
            do(element)
            next.each(do)
        }
    }
}

// Erlang-style Concurrency & Nested Packages.

package counter {
    enum public Message(public Increment, public Get)

    fun public start(task Task, n Int: 0) {
        select Message {
            .Increment {
                start(task, n: n + 1)
            }
            .Get {
                send(n, to: task)
                start(task, n)
            }
            timeout 10.seconds {
                throw Exception("timed out!")
            }
        }
    }
}

var c = do -> {
    var parent = currentTask
    Task -> { counter.start(task: parent) }
}
5.times -> { send(counter.Message.Increment, to: c) }
send(counter.Message.Get, to: c)
var n = select Int
println($"Counter: {n}")

class Name
    /** Data Definition with Keyword & Default Arguments */
(
    var public first String: "James",
    var public last String: "Bond",
) implements ToString {
    fun public override toString String {
        $"The name is {lastName}, {firstName} {lastName}."
    }
}

// Compile-time Programming & Macros (Reader Macros too; see Documentation)
fun final repeat(times Usize, syntax pipeline AstPipeline) {
    pipeline.finish(with: quasiquote {
        unquote {
            1.up(to: times).map(pipeline.source::)
        }
    })
}

fun demoContexts
    /** One for the Haskell Fans: Applicative Notation */
Optional[Int] {
    with {
        var x = Some(5)?
        Empty?
        println("Will not be run.")
        Empty
    }
}

// There's much more! See `examples/exhaustive_example.sy` for a demo of all
// language features, with explanatory comments for each.
